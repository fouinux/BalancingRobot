/*
 * HMC5883L.h
 *
 *  Created on: 29 mars 2018
 *      Author: fouinux@gmail.com
 */

#ifndef DRIVERS_HMC5883L_H_
#define DRIVERS_HMC5883L_H_

/* HMC5883L general definition */
#define HMC5883L_I2C_ADDR							0x3C

#define HMC5883L_GAIN_0_88G							((float) 0.00073)
#define HMC5883L_GAIN_1_30G							((float) 0.00092)
#define HMC5883L_GAIN_1_90G							((float) 0.00122)
#define HMC5883L_GAIN_2_50G							((float) 0.00152)
#define HMC5883L_GAIN_4_00G							((float) 0.00227)
#define HMC5883L_GAIN_4_70G							((float) 0.00256)
#define HMC5883L_GAIN_5_60G							((float) 0.00303)
#define HMC5883L_GAIN_8_10G							((float) 0.00435)

/* HMC5883L register definition */
#define HMC5883L_REG_ADDR_CFG_REG_A					0x00
	#define HMC5883L_CFG_REG_A_BN_MA						5
	#define HMC5883L_CFG_REG_A_BM_MA						(0x03 << HMC5883L_CFG_REG_A_BN_MA)
		#define HMC5883L_CFG_REG_A_BM_MA_1						(0x00 << HMC5883L_CFG_REG_A_BN_MA)
		#define HMC5883L_CFG_REG_A_BM_MA_2						(0x01 << HMC5883L_CFG_REG_A_BN_MA)
		#define HMC5883L_CFG_REG_A_BM_MA_4						(0x02 << HMC5883L_CFG_REG_A_BN_MA)
		#define HMC5883L_CFG_REG_A_BM_MA_8						(0x03 << HMC5883L_CFG_REG_A_BN_MA)
	#define HMC5883L_CFG_REG_A_BN_DO						2
	#define HMC5883L_CFG_REG_A_BM_DO						(0x07 << HMC5883L_CFG_REG_A_BN_DO)
		#define HMC5883L_CFG_REG_A_BM_DO_0_75					(0x00 << HMC5883L_CFG_REG_A_BN_DO)
		#define HMC5883L_CFG_REG_A_BM_DO_1_5					(0x01 << HMC5883L_CFG_REG_A_BN_DO)
		#define HMC5883L_CFG_REG_A_BM_DO_3_0					(0x02 << HMC5883L_CFG_REG_A_BN_DO)
		#define HMC5883L_CFG_REG_A_BM_DO_7_5					(0x03 << HMC5883L_CFG_REG_A_BN_DO)
		#define HMC5883L_CFG_REG_A_BM_DO_15_0					(0x04 << HMC5883L_CFG_REG_A_BN_DO)
		#define HMC5883L_CFG_REG_A_BM_DO_30_0					(0x05 << HMC5883L_CFG_REG_A_BN_DO)
		#define HMC5883L_CFG_REG_A_BM_DO_75_0					(0x06 << HMC5883L_CFG_REG_A_BN_DO)
	#define HMC5883L_CFG_REG_A_BN_MS						0
	#define HMC5883L_CFG_REG_A_BM_MS						(0x03 << HMC5883L_CFG_REG_A_BN_MS)
		#define HMC5883L_CFG_REG_A_BM_MS_NOR					(0x00 << HMC5883L_CFG_REG_A_BN_MS)
		#define HMC5883L_CFG_REG_A_BM_MS_POS					(0x01 << HMC5883L_CFG_REG_A_BN_MS)
		#define HMC5883L_CFG_REG_A_BM_MS_NEG					(0x02 << HMC5883L_CFG_REG_A_BN_MS)

#define HMC5883L_REG_ADDR_CFG_REG_B					0x01
	#define HMC5883L_CFG_REG_B_BN_GAIN						5
	#define HMC5883L_CFG_REG_B_BM_GAIN						(0x07 << HMC5883L_CFG_REG_B_BN_GAIN)
		#define HMC5883L_CFG_REG_B_BM_GAIN_0_88G				(0x00 << HMC5883L_CFG_REG_B_BN_GAIN)
		#define HMC5883L_CFG_REG_B_BM_GAIN_1_30G				(0x01 << HMC5883L_CFG_REG_B_BN_GAIN)
		#define HMC5883L_CFG_REG_B_BM_GAIN_1_90G				(0x02 << HMC5883L_CFG_REG_B_BN_GAIN)
		#define HMC5883L_CFG_REG_B_BM_GAIN_2_50G				(0x03 << HMC5883L_CFG_REG_B_BN_GAIN)
		#define HMC5883L_CFG_REG_B_BM_GAIN_4_00G				(0x04 << HMC5883L_CFG_REG_B_BN_GAIN)
		#define HMC5883L_CFG_REG_B_BM_GAIN_4_70G				(0x05 << HMC5883L_CFG_REG_B_BN_GAIN)
		#define HMC5883L_CFG_REG_B_BM_GAIN_5_60G				(0x06 << HMC5883L_CFG_REG_B_BN_GAIN)
		#define HMC5883L_CFG_REG_B_BM_GAIN_8_10G				(0x07 << HMC5883L_CFG_REG_B_BN_GAIN)

#define HMC5883L_REG_ADDR_MODE_REG					0x02
	#define HMC5883L_MODE_REG_BN_HS							7
	#define HMC5883L_MODE_REG_BM_HS							(0x01 << HMC5883L_MODE_REG_BN_HS)
	#define HMC5883L_MODE_REG_BN_MD							0
	#define HMC5883L_MODE_REG_BM_MD							(0x03 << HMC5883L_MODE_REG_BN_MD)
		#define HMC5883L_MODE_REG_BM_MD_CONTINUOUS				(0x00 << HMC5883L_MODE_REG_BN_MD)
		#define HMC5883L_MODE_REG_BM_MD_SINGLE					(0x01 << HMC5883L_MODE_REG_BN_MD)
		#define HMC5883L_MODE_REG_BM_MD_IDLE					(0x02 << HMC5883L_MODE_REG_BN_MD)

#define HMC5883L_REG_ADDR_DATA_OUT_X_MSB			0x03
#define HMC5883L_REG_ADDR_DATA_OUT_X_LSB			0x04
#define HMC5883L_REG_ADDR_DATA_OUT_Z_MSB			0x05
#define HMC5883L_REG_ADDR_DATA_OUT_Z_LSB			0x06
#define HMC5883L_REG_ADDR_DATA_OUT_Y_MSB			0x07
#define HMC5883L_REG_ADDR_DATA_OUT_Y_LSB			0x08

#define HMC5883L_REG_ADDR_STATUS_REG				0x09
	#define HMC5883L_STATUS_REG_BN_LOCK						7
	#define HMC5883L_STATUS_REG_BM_LOCK						(0x01 << HMC5883L_STATUS_REG_BN_LOCK)
	#define HMC5883L_STATUS_REG_BN_RDY						6
	#define HMC5883L_STATUS_REG_BM_RDY						(0x01 << HMC5883L_STATUS_REG_BN_RDY)

#define HMC5883L_REG_ADDR_ID_REG_A					0x0A
	#define HMC5883L_ID_REG_A								0x48
#define HMC5883L_REG_ADDR_ID_REG_B					0x0B
	#define HMC5883L_ID_REG_B								0x34
#define HMC5883L_REG_ADDR_ID_REG_C					0x0C
	#define HMC5883L_ID_REG_C								0x33

/* Public functions */
uint16_t HMC5883L_Init(void);
uint16_t HMC5883L_GetDataRaw(int16_t *pX, int16_t *pY, int16_t *pZ);
uint16_t HMC5883L_GetData(float *pX_gauss, float *pY_gauss, float *pZ_gauss);


#endif /* DRIVERS_HMC5883L_H_ */
